<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Electron HTTP/3 Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1 {
      color: #569cd6;
    }
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
      margin: 10px 0;
    }
    button:hover {
      background: #1177bb;
    }
    #result {
      background: #2d2d2d;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      white-space: pre-wrap;
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      font-size: 14px;
    }
    .success {
      color: #4ec9b0;
    }
    .error {
      color: #f14c4c;
    }
    .info {
      color: #9cdcfe;
    }
  </style>
</head>
<body>
  <h1>Electron HTTP/3 Request Test</h1>
  <p>Test HTTP/3 connectivity with different endpoints:</p>
  
  <button id="googleBtn">Test google.com (HTTP/3 supported)</button>
  <button id="cloudflareBtn">Test cloudflare.com (HTTP/3 supported)</button>
  <button id="pingBtn">Test api.githubcopilot.com/_ping</button>
  <button id="netInternalsBtn">Open chrome://net-internals/#quic</button>
  
  <div id="result">Click a button to start... Check DevTools Network tab for protocol.</div>

  <script>
    const { ipcRenderer } = require('electron');
    const resultDiv = document.getElementById('result');
    const pingBtn = document.getElementById('pingBtn');
    const cloudflareBtn = document.getElementById('cloudflareBtn');
    const googleBtn = document.getElementById('googleBtn');

    async function makeRequest(url) {
      resultDiv.innerHTML = '<span class="info">Making request to ' + url + '...</span>';
      
      try {
        const startTime = performance.now();
        
        // Use fetch - check Network tab for actual protocol
        const response = await fetch(url, {
          method: 'GET',
          headers: { 'Accept': '*/*' }
        });
        
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(2);
        
        const text = await response.text();
        const headers = {};
        response.headers.forEach((value, key) => {
          headers[key] = value;
        });
        
        let output = `<span class="success">✓ Request successful!</span>\n\n`;
        output += `<span class="info">URL:</span> ${url}\n`;
        output += `<span class="info">Status:</span> ${response.status}\n`;
        output += `<span class="info">Duration:</span> ${duration}ms\n\n`;
        
        if (headers['alt-svc']) {
          output += `<span class="info">Alt-Svc:</span> ${headers['alt-svc']}\n`;
          if (headers['alt-svc'].includes('h3')) {
            output += `<span class="success">→ Server supports HTTP/3! Click again to use it.</span>\n`;
          }
        }
        
        output += `\n<span class="info">Response Headers:</span>\n`;
        output += JSON.stringify(headers, null, 2).substring(0, 800) + '\n\n';
        output += `<span class="info">Response Body (first 200 chars):</span>\n`;
        output += (text || '(empty)').substring(0, 200);
        
        output += `\n\n<span class="info">→ Check DevTools Network tab → Protocol column for "h3"</span>`;
        
        resultDiv.innerHTML = output;
        
      } catch (error) {
        resultDiv.innerHTML = `<span class="error">✗ Error: ${error.message}</span>`;
      }
    }

    pingBtn.addEventListener('click', () => makeRequest('https://api.githubcopilot.com/_ping'));
    cloudflareBtn.addEventListener('click', () => makeRequest('https://www.cloudflare.com/'));
    googleBtn.addEventListener('click', () => makeRequest('https://www.google.com/'));
    netInternalsBtn.addEventListener('click', async () => {
      await ipcRenderer.invoke('open-net-internals');
    });
  </script>
</body>
</html>
